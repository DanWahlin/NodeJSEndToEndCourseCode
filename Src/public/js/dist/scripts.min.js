(codeWithDan=codeWithDan||{}).shoppingCart=($(document).ready(function(){$(".cartItem").click(function(){var e=$(this),t=e.attr("data-productId"),i=e.attr("data-priceType"),n=e.attr("data-discountCode");$('.cartItem[data-productid="'+t+'"').each(function(){var e=$(this),t=e.attr("data-pricetype");t===i?(e.html("In Cart"),window.setTimeout(function(){location.href="/cart"},500)):t.indexOf("rent")>-1?e.html("Rent"):e.html("Buy")}),addToCart(t,1,i,n)}),$(".removeCartItem").click(function(){var e=$(this).attr("data-productId");removeFromCart(e)})}),addToCart=function(e,t,i,n){$.post("/api/cart",{productId:e,quantity:t,priceType:i,discountCode:n,_csrf:codeWithDan.csrf}).done(function(e){updateValues(e.cart)}).fail(function(e,t,i){alert(i.message)})},updateValues=function(e){e||(e={total:0}),$(".cartTotal").text("$"+e.total.toFixed(2))},{updateValues:updateValues});var codeWithDan=codeWithDan||{};!function(e){e(document).ready(function(){e("#searchButton").click(function(){var t=e("#searchText").val();""!==t&&(location.href="/search?searchtext="+t)}),e(".category-header").click(function(){var t=e(this).attr("data-categoryId");e('.category-container div[data-categoryId="'+t+'"]').slideToggle(200)}),codeWithDan.helpers.isMobile()&&e("#carousel-codewithdan").swiperight(function(){e(this).carousel("prev")}).swipeleft(function(){e(this).carousel("next")}),codeWithDan.helpers.isIE()&&e(".parallax").css("background-attachment","scroll");for(var t=["/img/background_manrocks_1920x500.jpg"],i=0,n=t.length;i<n;i++)e("<img />").attr("src",t[i])})}(jQuery),codeWithDan.helpers={isMobile:function(){return null!=navigator.userAgent.match(/ipad|iphone|ipod|android|blackberry|webos|symbianos|silk|mobi/i)},isIE:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident")}},function(e){codeWithDan.helpers.isMobile()||codeWithDan.helpers.isIE()||(e(document).ready(function(){var t=e(window),i=[];e(".parallax").each(function(){i.push({item:e(this),speed:e(this).attr("data-speed")})}),t.scroll(function(){for(var e=0;e<i.length;e++){var n=i[e],o=n.item,a=n.speed?n.speed:5,r="50% "+-(t.scrollTop()-o.offset().top)/a+"px";o.css({backgroundPosition:r})}})}),document.createElement("article"),document.createElement("section"))}(jQuery),codeWithDan.videoManager=function(){var e,t,i,n,o,a,r=null,d=null,c=!1,s=null,l=codeWithDan.helpers.isMobile(),u=function(){fakewaffle.responsiveTabs(["xs","sm"]),$(".module-title").click(function(){var e=$(this).attr("data-moduleId");$('.modules-container div[data-moduleId="'+e+'"]').slideToggle(100)}),$(".video-link").click(p),o.on("hide.bs.modal",function(e){t.api("unload")})},f=function(){t.api("getDuration",function(e){i=e}),t.addEvent("finish",function(e){g("finished")}),t.addEvent("play",function(e){I()}),t.addEvent("playProgress",function(e,t){r.currentVideoTime=e.seconds}),t.addEvent("pause",function(e){y(),g("setmarker")}),c&&(seekTo(),c=!1)},m=function(){var t=e.attr("data-productId");$.get("/api/progress/",{productId:t},function(e){if(n=e,r=e.currentlyViewing)r.initialLoad=!0,v();else{var t=n.product.modules[0],i=t.sections[0];setCurrentlyViewing(t.moduleId,i.sectionId,i.videoUrl),h(!1,!1)}if(n.userProgress)for(var o=n.userProgress.completedSections,a=0;a<o.length;a++)markCompleted(o[a])})},p=function(){var e=$(this),t=e.attr("data-moduleId"),i=e.attr("data-sectionId"),n=getModuleAndSection(t,i).section.videoUrl,d=e.attr("data-videoTitle");r&&r.initialLoad?(r.initialLoad=!1,h(!0,!0)):(setCurrentlyViewing(t,i,n),h(!1,!0),g("setmarker")),a.html(d),o.modal("show")},h=function(i,n){e.attr("src",r.videoUrl+"?api=1&player_id=videoPlayer&color=547DFD"),t||e.load(function(){(t=$f(e[0])).addEvent("ready",f)}),c=i,v()},v=function(){d&&d.removeClass("currently-viewing-video"),(d=$('div[data-sectionId="'+r.sectionId+'"]')).addClass("currently-viewing-video")},g=function(e){var t=r;t.action=e,$.post("/api/progress/",{_csrf:codeWithDan.csrf,userProgress:t},function(t){"finished"===e&&(markCompleted(r.sectionId),moveToNextVideo())})},I=function(){s||(s=setInterval(function(){g("setmarker")},3e4))},y=function(){s&&(clearInterval(s),s=null)};return markCompleted=function(e){$('span[data-sectionId="'+e+'"]').addClass("fa-check")},seekTo=function(){if(r){var e=r.currentVideoTime-2;e<0&&(e=0),t.api("seekTo",e);var i=setTimeout(function(){clearTimeout(i)},500)}},moveToNextVideo=function(){findNextSection()?(h(!1,!0),g("setmarker")):y()},getModuleAndSection=function(e,t){var i=n.product.modules,o=itemIndex(i,"moduleId",e),a=itemIndex(i[o].sections,"sectionId",t);return{moduleIndex:o,module:i[o],sectionIndex:a,section:i[o].sections[a]}},findNextSection=function(){var e,t,i=getModuleAndSection(r.moduleId,r.sectionId),o=n.product.modules,a=i.moduleIndex,d=i.sectionIndex;return o[a].sections.length-1>d?t=(e=o[a]).sections[d+1]:o.length-1>a&&(t=(e=o[a+1]).sections[0]),e&&t?(setCurrentlyViewing(e.moduleId,t.sectionId,t.videoUrl),{module:e,section:t}):null},setCurrentlyViewing=function(e,t,i,o){r={productId:n.product._id,moduleId:e,sectionId:t,videoUrl:i,currentVideoTime:o||0}},itemIndex=function(e,t,i){if(!e)return-1;return t?e.map(function(e){return e[t].toString()}).indexOf(i):e.map(function(e){return e.toString()}).indexOf(i)},{init:function(){(e=$("#videoPlayer")).length&&(o=$("#modalVideo"),a=$("#modalVideoTitle"),l&&o.removeClass("fade"),u(),m())}}}(),codeWithDan.isAuthenticated&&codeWithDan.videoManager.init(),codeWithDan.videoPreviewManager=function(){var e,t,i,n,o=!1,a=codeWithDan.helpers.isMobile(),r=function(){$(".video-preview-link").click(c),i.on("hide.bs.modal",function(e){t.api("unload")})},d=function(){o&&(a||t.api("play"),o=!1)},c=function(){var a=$(this).attr("data-videourl")+"?api=1&player_id=videoPlayer&color=547DFD",r=$(this).attr("data-videoTitle");e.attr("src",a),o=!0,t||e.load(function(){(t=$f(e[0])).addEvent("ready",d)}),n.html(r),i.modal("show")};return{init:function(){(e=$("#videoPlayer")).length&&(i=$("#modalVideo"),n=$("#modalVideoTitle"),a&&i.removeClass("fade"),r())}}}(),codeWithDan.videoPreviewManager.init();